# File Transfers

## Introducción

Existen muchas situaciones en las que es necesario transferir archivos hacia o desde un sistema objetivo. Imaginemos el siguiente escenario:

### Escenario

Durante un pentesting, obtenemos ejecución remota de código (RCE) en un servidor IIS a través de una vulnerabilidad de carga de archivos sin restricciones. Inicialmente subimos una web shell y luego nos enviamos una reverse shell para enumerar el sistema y tratar de escalar privilegios. Intentamos usar PowerShell para transferir **PowerUp.ps1** (un script de PowerShell para enumerar vectores de escalada de privilegios), pero PowerShell está bloqueado por la Política de Control de Aplicaciones. Realizamos la enumeración manualmente y descubrimos que tenemos el privilegio **SeImpersonatePrivilege**. Ahora necesitamos transferir un binario a la máquina objetivo para escalar privilegios utilizando la herramienta **PrintSpoofer**.

Intentamos usar **Certutil** para descargar el archivo desde nuestro propio GitHub, pero la organización cuenta con un fuerte filtrado de contenido web. No podemos acceder a sitios como GitHub, Dropbox, Google Drive, etc., que podrían usarse para transferir archivos. A continuación, configuramos un servidor FTP y tratamos de usar el cliente FTP de Windows para transferir archivos, pero el firewall de la red bloquea el tráfico saliente por el puerto 21 (TCP). Probamos con la herramienta **Impacket smbserver** para crear una carpeta compartida, y encontramos que el tráfico saliente por el puerto 445 (SMB) estaba permitido. Usamos este método de transferencia de archivos para copiar el binario en la máquina objetivo y logramos escalar privilegios a nivel de administrador.

Entender las distintas formas de realizar transferencias de archivos y cómo operan las redes nos puede ayudar a alcanzar nuestros objetivos durante una evaluación. Debemos estar conscientes de los controles del sistema que pueden bloquear nuestras acciones, como la lista blanca de aplicaciones o el AV/EDR bloqueando aplicaciones o actividades específicas. Las transferencias de archivos también se ven afectadas por dispositivos de red como firewalls, IDS o IPS, que pueden monitorear o bloquear ciertos puertos o actividades no comunes.

La transferencia de archivos es una característica fundamental de cualquier sistema operativo, y existen muchas herramientas para lograrlo. Sin embargo, muchas de estas herramientas pueden ser bloqueadas o monitoreadas por administradores atentos, por lo que es importante revisar una variedad de técnicas que podrían ser posibles en un entorno determinado.

Este módulo cubre técnicas que aprovechan herramientas y aplicaciones comúnmente disponibles en sistemas Windows y Linux. La lista de técnicas no es exhaustiva. La información en este módulo también puede ser utilizada como una guía de referencia cuando se trabajen otros módulos de **HTB Academy**, ya que muchos de los ejercicios requerirán que transfiramos archivos hacia/desde un host objetivo o desde/hacia el **Pwnbox**. Se proporcionan máquinas objetivo Windows y Linux para completar algunos ejercicios prácticos como parte del módulo. Es recomendable usar estos objetivos para experimentar con la mayor cantidad posible de las técnicas demostradas en las secciones del módulo. Observa las diferencias entre los distintos métodos de transferencia y toma nota de las situaciones donde cada uno sería útil. Una vez que hayas completado este módulo, prueba las distintas técnicas en otros módulos, máquinas y laboratorios en la plataforma principal de HTB.
